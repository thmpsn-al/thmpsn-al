<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kieliharjoituspeli</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .hint-list {
            margin-top: 20px;
        }

        .hint-item {
            margin-bottom: 10px;
        }

        #feedback {
            font-weight: bold;
            margin-top: 10px;
        }

        .quiz-option {
            margin-top: 10px;
            display: block;
        }

        .correct {
            color: green;
        }

        .incorrect {
            color: red;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="text-center">Kieliharjoituspeli</h1>

    <div id="game-area" class="mt-5">
        <!-- This is where game content (questions) will appear -->
    </div>

    <div id="feedback"></div>

    <div id="score" class="mt-3">Pisteet: 0</div>

    <button id="next-question" class="btn btn-primary mt-3" style="display: none;">Seuraava kysymys</button>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(function() {
        let score = 0;
        let totalQuestions = 0;

        const words = [
            { word: "tabletti", forms: ["en platta", "plattan", "plattor", "plattorna"] },
            { word: "näyttö", forms: ["en skärm", "skärmen", "skärmar", "skärmarna"] },
            { word: "sanomalehti", forms: ["en tidning", "tidningen", "tidningar", "tidningarna"] },
            { word: "kuva", forms: ["en bild", "bilden", "bilder", "bilderna"] },
            { word: "videoklippi", forms: ["ett videoklipp", "videoklippet", "videoklipp", "videoklippen"] },
            { word: "otsikko", forms: ["en rubrik", "rubriken", "rubriker", "rubrikerna"] },
            { word: "veli", forms: ["en bror", "brodern", "bröder", "bröderna"] },
            { word: "netti", forms: ["ett nät", "nätet", "nät", "näten"] }
        ];

        const adjectives = [
            { adj: "mahtava, siisti, upea", forms: ["häftig", "häftigare", "häftigast"] },
            { adj: "siisti", forms: ["snygg", "snyggare", "snyggast"] },
            { adj: "nopea", forms: ["snabb", "snabbare", "snabbast"] },
            { adj: "hauska", forms: ["rolig", "roligare", "roligast"] },
            { adj: "hyvä", forms: ["bra", "bättre", "bäst"] },
            { adj: "halpa", forms: ["billig", "billigare", "billigast"] },
            { adj: "kallis", forms: ["dyr", "dyrare", "dyrast"] },
            { adj: "viihtyisä", forms: ["mysig", "mysigare", "mysigast"] },
            { adj: "vaikea", forms: ["svår", "svårare", "svårast"] },
            { adj: "lämmin", forms: ["varm", "varmare", "varmast"] },
            { adj: "mukava", forms: ["trevlig", "trevligare", "trevligast"] },
            { adj: "lyhyt", forms: ["kort", "kortare", "kortast"] },
            { adj: "iloinen", forms: ["glad", "gladare", "gladast"] },
            { adj: "ikävä, tylsä", forms: ["tråkig", "tråkigare", "tråkigast"] },
            { adj: "urheilullinen", forms: ["sportig", "sportigare", "sportigast"] },
            { adj: "söpö", forms: ["söt", "sötare", "sötast"] },
            { adj: "taitava", forms: ["duktig", "duktigare", "duktigast"] },
            { adj: "hassu", forms: ["tokig", "tokigare", "tokigast"] },
            { adj: "hieno", forms: ["fin", "finare", "finast"] },
            { adj: "suuri", forms: ["stor", "större", "störst"] },
            { adj: "vanha", forms: ["gammal", "äldre", "äldst"] },
            { adj: "pitkä", forms: ["lång", "längre", "längst"] },
            { adj: "nuori", forms: ["ung", "yngre", "yngst"] },
            { adj: "huono", forms: ["dålig", "sämre", "sämst"] }
        ];

        const quizQuestions = [
            // Kysymykset suomi -> ruotsi
            { question: "Mikä on ruotsiksi 'veli'?", correct: "en bror" },
            { question: "Mikä on ruotsiksi 'sanomalehti'?", correct: "en tidning" },
            { question: "Mikä on ruotsiksi 'tabletti'?", correct: "en platta" },
            { question: "Mikä on ruotsiksi 'näyttö'?", correct: "en skärm" },
            { question: "Mikä on ruotsiksi 'kuva'?", correct: "en bild" },
            { question: "Mikä on ruotsiksi 'videoklippi'?", correct: "ett videoklipp" },
            { question: "Mikä on ruotsiksi 'otsikko'?", correct: "en rubrik" },
            { question: "Mikä on ruotsiksi 'netti'?", correct: "ett nät" },
            { question: "Mikä on ruotsiksi 'tietokoneella'?", correct: "vid datorn" },
            { question: "Mikä tarkoittaa 'eilen illalla'?", correct: "i går kväll" },
            { question: "Mikä tarkoittaa 'vuorokauden ympäri'?", correct: "dygnet runt" },
            { question: "Mikä tarkoittaa 'parempi kuin'?", correct: "bättre än" },
            { question: "Mikä tarkoittaa 'komein'?", correct: "snyggast" },
            { question: "Mikä tarkoittaa 'halvin'?", correct: "billigast" },
            { question: "Mikä tarkoittaa 'yhdessä'?", correct: "tillsammans" },
            { question: "Mikä tarkoittaa 'koko maailma'?", correct: "hela världen" },

            // Kysymykset ruotsi -> suomi
            { question: "Mikä on suomeksi 'en tidning'?", correct: "sanomalehti" },
            { question: "Mikä on suomeksi 'en skärm'?", correct: "näyttö" },
            { question: "Mikä on suomeksi 'en platta'?", correct: "tabletti" },
            { question: "Mikä on suomeksi 'en bror'?", correct: "veli" },
            { question: "Mikä on suomeksi 'ett nät'?", correct: "netti" },
            { question: "Mikä on suomeksi 'ett videoklipp'?", correct: "videoklippi" },
            { question: "Mikä tarkoittaa 'i går kväll'?", correct: "eilen illalla" },
            { question: "Mikä on suomeksi 'dygnet runt'?", correct: "vuorokauden ympäri" },
            { question: "Mitä tarkoittaa 'efter nyheterna'?", correct: "uutisten jälkeen" },
            { question: "Mitä tarkoittaa 'snabbare och roligare'?", correct: "nopeampi ja hauskempi" }
        ];

        let usedWords = [];
        let usedAdjectives = [];
        let usedQuizzes = [];
        let currentWordData = null;
        let currentMissingFormIndex = null;
        let currentQuestionType = null; // Either 'form', 'adjective', or 'quiz'

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function getRandomOptions(correctAnswer, lang) {
            const allOptions = lang === 'ruotsi'
                ? quizQuestions.filter(q => q.correct.includes('en') || q.correct.includes('ett')).map(q => q.correct)
                : quizQuestions.filter(q => !q.correct.includes('en') && !q.correct.includes('ett')).map(q => q.correct);

            const filteredOptions = allOptions.filter(opt => opt !== correctAnswer);
            const shuffledOptions = shuffle(filteredOptions);
            const wrongOptions = shuffledOptions.slice(0, 2);
            return shuffle([correctAnswer, ...wrongOptions]);
        }

        function getNextQuestion() {
            $("#feedback").hide();
            $("#next-question").hide();
            $("#game-area").empty();

            const randomType = Math.random();

            if (randomType < 0.33 && usedWords.length < words.length) {
                currentQuestionType = 'form';
                let wordData = words.find(word => !usedWords.includes(word.word));
                usedWords.push(wordData.word);

                currentWordData = wordData;
                currentMissingFormIndex = Math.floor(Math.random() * wordData.forms.length);
                displayWordFormQuestion(wordData, currentMissingFormIndex);
            } else if (randomType < 0.66 && usedAdjectives.length < adjectives.length) {
                currentQuestionType = 'adjective';
                let adjData = adjectives.find(adj => !usedAdjectives.includes(adj.adj));
                usedAdjectives.push(adjData.adj);

                currentWordData = adjData;
                currentMissingFormIndex = Math.floor(Math.random() * adjData.forms.length);
                displayAdjectiveFormQuestion(adjData, currentMissingFormIndex);
            } else if (usedQuizzes.length < quizQuestions.length) {
                currentQuestionType = 'quiz';
                let quizData = quizQuestions.find(quiz => !usedQuizzes.includes(quiz.question));
                usedQuizzes.push(quizData.question);
                displayQuiz(quizData);
            }

            if (usedWords.length === words.length && usedAdjectives.length === adjectives.length && usedQuizzes.length === quizQuestions.length) {
                endGame();
            }
        }

        // Näytetään sana ja muut taivutusmuodot, paitsi yksi
        function displayWordFormQuestion(wordData, missingFormIndex) {
            const hints = wordData.forms.map((form, index) => {
                if (index === missingFormIndex) {
                    return `<strong>______</strong> `;
                }
                return `<span class="hint-item">${form}</span>`;
            }).join(', ');

            $("#game-area").html(`
                <h3>Anna oikea muoto sanasta: ${wordData.word}</h3>
                <div class="hint-list">${hints}</div>
                <input type="text" id="user-answer" class="form-control mt-3" placeholder="Kirjoita puuttuva muoto">
                <button id="check-answer" class="btn btn-primary mt-3">Tarkista</button>
            `);

            $("#check-answer").click(function() {
                checkAnswer(wordData.forms[missingFormIndex]);
            });
        }

        // Näytetään adjektiivin muotojen täyttämistehtävä
        function displayAdjectiveFormQuestion(adjData, missingFormIndex) {
            const hints = adjData.forms.map((form, index) => {
                if (index === missingFormIndex) {
                    return `<strong>_____</strong> `;
                }
                return `<span class="hint-item">${form}</span>`;
            }).join(', ');

            $("#game-area").html(`
                <h3>Anna oikea muoto adjektiivista: ${adjData.adj}</h3>
                <div class="hint-list">${hints}</div>
                <input type="text" id="user-answer" class="form-control mt-3" placeholder="Kirjoita puuttuva muoto">
                <button id="check-answer" class="btn btn-primary mt-3">Tarkista</button>
            `);

            $("#check-answer").click(function() {
                checkAnswer(adjData.forms[missingFormIndex]);
            });
        }

        // Tarkistetaan käyttäjän antama vastaus
        function checkAnswer(correctAnswer) {
            const userAnswer = $("#user-answer").val().trim();

            if (userAnswer === correctAnswer) {
                score++;
                $("#feedback").text("Oikein!").removeClass("incorrect").addClass("correct").show();
            } else {
                $("#feedback").text(`Väärin! Oikea vastaus on: ${correctAnswer}`).removeClass("correct").addClass("incorrect").show();
            }

            updateScore();
            $("#next-question").show();
        }

        // Näytetään monivalintakysymys
        function displayQuiz(quizData) {
            const lang = quizData.question.includes('ruotsiksi') ? 'ruotsi' : 'suomi';
            const options = getRandomOptions(quizData.correct, lang);

            $("#game-area").html(`
                <h3>${quizData.question}</h3>
                <div id="quiz-options" class="mt-3"></div>
            `);

            options.forEach(option => {
                $("#quiz-options").append(`
                    <button class="btn btn-outline-primary quiz-option" data-correct="${option === quizData.correct}">${option}</button>
                `);
            });

            $(".quiz-option").click(function() {
                const isCorrect = $(this).data("correct") === true;
                if (isCorrect) {
                    score++;
                    $("#feedback").text("Oikein!").removeClass("incorrect").addClass("correct").show();
                } else {
                    $("#feedback").text("Väärin!").removeClass("correct").addClass("incorrect").show();
                }

                updateScore();
                $("#next-question").show();
            });
        }

        // Päivitä pistetilanne
        function updateScore() {
            $("#score").text(`Pisteet: ${score}`);
        }

        // Kun kaikki kysymykset on käyty läpi
        function endGame() {
            $("#game-area").html(`
                <h3>Olet käynyt kaikki kysymykset läpi!</h3>
                <p>Kokonaispisteet: ${score}/${totalQuestions}</p>
                <button id="restart-game" class="btn btn-primary mt-3">Aloita alusta</button>
            `);

            $("#restart-game").click(function() {
                location.reload();
            });
        }

        // Laske kysymysten kokonaismäärä
        totalQuestions = words.length + quizQuestions.length + adjectives.length;
        getNextQuestion();

        $("#next-question").click(getNextQuestion);
    });
</script>

</body>
</html>
